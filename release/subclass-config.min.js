/**
 * subclass-config - v0.1.0 - 2015-10-07
 * https://github.com/msdoom2011/subclass-config
 *
 * Copyright (c) 2015 Dmitry Osipishin | msdoom2011@gmail.com
 */
!function(){"use strict";Subclass.Class.Type.Config={},Subclass.Class.Type.Config.Config=function(){function a(b,c,d){this._includes=[],a.$parent.apply(this,arguments)}return a.$parent=Subclass.Class.ClassType,a.getClassTypeName=function(){return"Config"},a.getBuilderClass=function(){return Subclass.Class.Type.Config.ConfigBuilder},a.getDefinitionClass=function(){return Subclass.Class.Type.Config.ConfigDefinition},a.prototype.setParent=function(b){this._parent&&this._parent.constructor!=a&&Subclass.Error.create('The config "'+this.getName()+'" can be inherited only from an another config.'),a.$parent.prototype.setParent.apply(this,arguments)},a.prototype.getConstructorEmpty=function(){return function a(){return a.name}},a.prototype.getIncludes=function(){return this._includes},a.prototype.addInclude=function(a){a&&"string"==typeof a||Subclass.Error.create("InvalidArgument").argument("the name of including class",!1).received(a).expected("a name of existent config class").apply(),this.getClassManager().isset(a)||Subclass.Error.create('Trying to include non existent class "'+a+'" to config class "'+this.getName()+'".');var b=this.getClassManager().get(a);this._includes.push(b)},a.prototype.isIncludes=function(a){a&&"string"==typeof a||Subclass.Error.create("InvalidArgument").argument("the name of included class",!1).received(a).expected("a string").apply();for(var b=this.getIncludes(),c=0;c<b.length;c++)if(b[c].isInstanceOf(a))return!0;if(this.hasParent()){var d=this.getParent();if(d.isIncludes)return d.isIncludes(a)}return!1},Subclass.ClassManager.registerType(a),a}(),Subclass.Class.Type.Config.ConfigBuilder=function(){function a(b,c,d){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Class.ClassBuilder,a.prototype._validateIncludes=function(a){try{if(!Array.isArray(a))throw"error";for(var b=0;b<a.length;b++)this._validateInclude(a[b])}catch(c){Subclass.Error.create("InvalidArgument").argument("the list of config including class names",!1).received(a).expected("an array of strings").apply()}},a.prototype._validateInclude=function(a){"string"!=typeof a&&"object"!=typeof a&&a.getClassTypeName&&"Config"!==a.getClassTypeName()&&Subclass.Error.create("InvalidArgument").argument("the name of including config class",!1).expected("an instance of config class or a string").received(a).apply()},a.prototype._normalizeIncludes=function(a){for(var b=0;b<a.length;b++)a[b]=this._normalizeInclude(a[b])},a.prototype._normalizeInclude=function(a){return this._validateInclude(a),"string"!=typeof a?a.getName():void 0},a.prototype.setIncludes=function(a){return this._validateIncludes(a),this._normalizeIncludes(a),this.getDefinition().$_includes=a,this},a.prototype.addIncludes=function(a){return this._validateIncludes(a),this.getDefinition().$_includes||(this.getDefinition().$_includes=[]),this.getDefinition().$_includes=this.getDefinition().$_includes.concat(a),this},a.prototype.addInclude=function(a){return this._validateInclude(a),this.getDefinition().$_includes||(this.getDefinition().$_includes=[]),this.getDefinition().$_includes.push(a),this},a.prototype.getIncludes=function(){return this.getDefinition().$_includes||[]},a.prototype.setFinal=function(a){return"boolean"!=typeof a&&Subclass.Error.create("InvalidArgument").argument("is final option value",!1).expected("a boolean").received(a).apply(),this.getDefinition().$_final=a,this},a.prototype.getFinal=function(){return this.getDefinition().$_final},a}(),Subclass.Class.Type.Config.ConfigDefinition=function(){function a(b,c){a.$parent.apply(this,arguments),this._originProperties={}}return a.$parent=Subclass.Class.ClassDefinition,a.prototype.setOriginProperties=function(a){this._originProperties=a},a.prototype.getOriginProperties=function(){return this._originProperties},a.prototype.validateIncludes=function(a){try{if(a&&!Array.isArray(a))throw"error";if(a)for(var b=0;b<a.length;b++)if("string"!=typeof a[b])throw"error"}catch(c){if("error"!=c)throw c;Subclass.Error.create("InvalidClassOption").option("$_includes").className(this.getClass().getName()).received(a).expected("an array of strings").apply()}return!0},a.prototype.setIncludes=function(a){if(this.validateIncludes(a),this.getData().$_includes=a||[],a)for(var b=0;b<a.length;b++)this.getClass().addInclude(a[b])},a.prototype.getIncludes=function(){return this.getData().$_includes||[]},a.prototype.validateFinal=function(a){return"boolean"!=typeof a&&Subclass.Error.create("InvalidClassOption").option("$_final").className(this.getClass().getName()).received(a).expected("a boolean").apply(),!0},a.prototype.setFinal=function(a){this.validateFinal(a),this.getData().$_final=a},a.prototype.getFinal=function(){var a=this.getClass(),b=this.getData();return a.hasParent()?b.$_final?!0:a.getParent().getDefinition().getFinal():this.getData().$_final},a.prototype.isFinal=function(){return this.getFinal()},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.$_final=!1,b.$_includes=[],b.setData=function(a){a&&Subclass.Tools.isPlainObject(a)||Subclass.Error.create("InvalidArgument").argument("the config class values",!1).received(a).expected("a plain object").apply();for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},b.getData=function(){var a=this.$_class.getProperties(!0),b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=this.getProperty(c).getData());return b},b.setDefaults=function(a){for(var b in a)a.hasOwnProperty(b)&&this.getProperty(b).setDefaultValue(a[b]);return a},b.getDefaults=function(){var a={},b=this.$_class.getProperties(!0);for(var c in b)b.hasOwnProperty(c)&&(a[c]=this.getProperty(c).getDefaultValue());return a},b},a.prototype.normalizeData=function(){var b,c=this.getBaseData(),d=this.getData(),e=this.getProperties(),f={};for(b in c)c.hasOwnProperty(b)&&d.hasOwnProperty(b)&&(f[b]=d[b],delete d[b]);this._data={};var g=this._data;e||(e={}),g.$_properties=Subclass.Tools.extend(e,d),this.setOriginProperties(Subclass.Tools.copy(g.$_properties));for(b in f)if(f.hasOwnProperty(b)&&"$_properties"!=b){var h=Subclass.Tools.generateValidatorName(b.replace(/^\$_/i,""));this[h]&&this[h](f[b])&&(g[b]=f[b])}a.$parent.prototype.normalizeData.call(this);for(b in g.$_properties)g.$_properties.hasOwnProperty(b)&&(g.$_properties[b].accessors=!1)},a.prototype.validateData=function(){if(!a.$parent.prototype.validateData.apply(this,arguments))return!1;if(this.getExtends()){var b=this.getExtends(),c=this.getClass().getClassManager().get(b),d=c.getDefinition();if(d.isFinal()){for(var e=this.getDefinedProperties(),f=this.getNewProperties(),g=0;g<f.length;g++){var h=e.indexOf(f[g]);h>=0&&e.splice(h,1)}e.length>0&&Subclass.Error.create('Trying to change definitions of typed properties ("'+e.join('", "')+'") for the config class "'+this.getClass().getName()+'" which extends the final config class "'+b+'".')}}return!0},a.prototype.validateProperties=function(b){if(this.getExtends()){var c=this.getExtends(),d=this.getClass().getClassManager().get(c),e=d.getDefinition();if(e.isFinal()){var f=this.getNewProperties(b);f.length>0&&Subclass.Error.create('Trying to define new typed properties ("'+f.join('", "')+'") for the config class "'+this.getClass().getName()+'" which extends the final config class "'+c+'".')}}return a.$parent.prototype.validateProperties.apply(this,arguments)},a.prototype.getPropertyNormalizers=function(){var b=a.$parent.prototype.getPropertyNormalizers.apply(this,arguments),c=this;return b.unshift(function(a){var b=c.getIncludes();if(!b)return a;for(var d=0;d<b.length;d++){var e=b[d],f=c.getClass().getClassManager().get(e),g=(f.getConstructor(),f.getDefinition().getProperties());a=c.extendProperties(g,a)}return a}),b},a.prototype.processRelatedClasses=function(){a.$parent.prototype.processRelatedClasses.call(this);var b=this.getClass().getClassManager(),c=this.getIncludes();if(c&&this.validateIncludes(c))for(var d=0;d<c.length;d++)b.load(c[d])},a.prototype.getNewProperties=function(a){var b=[];if(a)b=Object.keys(a);else{b=Object.keys(this.getOriginProperties());for(var c=this.getClass().getClassManager(),d=this.getIncludes(),e=0;e<d.length;e++){var f=c.get(d[e]),g=(f.getConstructor(),f.getProperties(!0));b=b.concat(Object.keys(g))}}if(this.getExtends()){var h=this.getExtends(),i=this.getClass().getClassManager().get(h),j=Object.keys(i.getProperties(!0));for(e=0;e<j.length;e++){var k=b.indexOf(j[e]);k>=0&&b.splice(k,1)}}return Subclass.Tools.unique(b)},a.prototype.getDefinedProperties=function(){for(var a=this.getClass().getClassManager(),b=this.getOriginProperties(),c=this.getIncludes(),d=[],e=0;e<c.length;e++){var f=a.get(c[e]),g=f.getDefinition();d=d.concat(g.getDefinedProperties()),f.hasParent()&&(d=d.concat(f.getParent().getDefinition().getDefinedProperties()))}for(var h in b)b.hasOwnProperty(h)&&"object"==typeof b[h]&&b[h].hasOwnProperty("type")&&d.push(h);return Subclass.Tools.unique(d)},a}(),Subclass.Parser.ConfigParser=function(){function ConfigParser(){ConfigParser.$parent.apply(this,arguments)}return ConfigParser.$parent=Subclass.Parser.ParserAbstract,ConfigParser.getName=function(){return"config"},ConfigParser.prototype={parse:function(string){if("string"==typeof string&&string.match(/\$.+\$/i)){var parserManager=this.getParserManager(),moduleInstance=parserManager.getModuleInstance(),configContainer=moduleInstance.getConfigContainer(),configManager=configContainer.getConfigManager(),regExpStr="\\$([^\\$]+)\\$",regExp=new RegExp(regExpStr,"i"),configs=configContainer.getConfigs()||configManager.getDefaults(),configName,configValue;if(new RegExp("^"+regExpStr+"$","i").test(string))configName=string.match(regExp)[1],configValue=eval("(configs."+configName+")"),string=this.getParserManager().parse(configValue);else for(;regExp.test(string);)configName=string.match(regExp)[1],configValue=eval("(configs."+configName+")"),string=string.replace(regExp,this.getParserManager().parse(configValue))}return string}},Subclass.Parser.ParserManager.registerParser(ConfigParser),ConfigParser}(),Subclass.ClassManager.register("AbstractClass","Subclass/ConfiguratorAbstract",{$_implements:["Subclass/ConfiguratorInterface"],_configManager:null,setConfigManager:function(a){a&&a instanceof Subclass.Property.ConfigManager||Subclass.Error.create("InvalidArgument").argument("the instance of subclass config manager",!1).expected('an instance of class "Subclass.Property.ConfigManager"').received(a).apply(),this._configManager=a},getConfigManager:function(){return this._configManager},getModuleInstance:function(){var a=this.getConfigManager(),b=a.getConfigContainer();return b.getModuleInstance()},isPrivate:function(){return!1},isExpanded:function(){return!1},getTree:function(){return{type:"map",schema:{},nullable:!0,"default":null}},alterTree:function(a,b){},processConfigs:function(a,b){}}),Subclass.ClassManager.register("Interface","Subclass/ConfiguratorInterface",{setConfigManager:function(a){},getConfigManager:function(){},getModuleInstance:function(){},getName:function(){},isPrivate:function(){},isExpanded:function(){},getTree:function(){},alterTree:function(a,b){},processConfigs:function(a,b){}}),Subclass.Property={},Subclass.Property.Error={},Subclass.Property.Type={},Subclass.Property.Extension={},Subclass.Property.Extension.Class={},Subclass.Property.Extension.Class.Type={},Subclass.Property.Extension.Class.Type.Class={},Subclass.Property.Extension.Class.Type.AbstractClass={},Subclass.Property.Extension.Class.Type.Interface={},Subclass.Property.Extension.Class.Type.Trait={},Subclass.Property.PropertyManager=function(){function a(a){this._module=a,this._typeDefinitions={},this._types={}}return a.prototype.initialize=function(){var b=this.getModule(),c=b.getEventManager(),d=this;if(c.getEvent("onLoadingEnd").addListener(function(){var a=d.getTypeDefinitions();for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];d._types[b]=d.createProperty(b,Subclass.Tools.copy(c))}}),b.isRoot()){var e=a.getPropertyTypes(),f={};for(var g in e)if(e.hasOwnProperty(g)){var h=e[g].getEmptyDefinition();h&&(f[g]=h)}this._typeDefinitions=Subclass.Tools.extendDeep(f,this._typeDefinitions)}},a.prototype.getModule=function(){return this._module},a.prototype.validateTypeDefinitions=function(a){try{if(!Subclass.Tools.isPlainObject(a))throw"error";for(var b in a)if(a.hasOwnProperty(b)&&!Subclass.Tools.isPlainObject(a[b]))throw"error"}catch(c){if("error"!=c)throw c;Subclass.Error.create("InvalidArgument").argument("the data type definitions",!1).received(a).expected("a plain object with another plain objects").apply()}},a.prototype.addTypeDefinitions=function(a){this.validateTypeDefinitions(a);for(var b in a)a.hasOwnProperty(b)&&(this._typeDefinitions[b]=a[b])},a.prototype.normalizeTypeDefinition=function(b,c){if((void 0===b||null===b)&&Subclass.Error.create("InvalidArgument").argument("the definition of property"+(c?' "'+c+'"':""),!1).received(b).expected("not null and not undefined").apply(),"string"==typeof b&&this.issetType(b))return this.getTypeDefinition(b);if(Array.isArray(b)&&b.length>=1){var d,e;b[0]&&a.issetPropertyType(b[0])?(d=b[0],e=a.getPropertyType(d),b=e.normalizeDefinition(b)):b[0]&&this.issetType(b[0])&&(d=b[0],b=this.getTypeDefinition(d))}return b},a.prototype.getTypeDefinitions=function(a){var b=this.getModule(),c=b.getModuleStorage(),d={},e=this;return a!==!0&&(a=!1),a?this._typeDefinitions:(c.eachModule(function(a){if(a==b)return void Subclass.Tools.extend(d,e._typeDefinitions);var c=a.getPropertyManager(),f=c.getTypeDefinitions();Subclass.Tools.extend(d,f)}),d)},a.prototype.getTypeDefinition=function(a){return this.issetType(a)||Subclass.Error.create('Trying to get definition of non existent data type "'+a+'".'),this.getTypeDefinitions()[a]},a.prototype.getTypes=function(a){var b=this.getModule(),c=b.getModuleStorage(),d={},e=this;return a!==!0&&(a=!1),a?this._types:(c.eachModule(function(a){if(a==b)return void Subclass.Tools.extend(d,e._types);var c=a.getPropertyManager(),f=c.getTypes();Subclass.Tools.extend(d,f)}),d)},a.prototype.getType=function(a){return this.issetType(a)||Subclass.Error.create('Trying to get definition of non existent data type "'+a+'".'),this.getTypes()[a]},a.prototype.issetType=function(a){return this.getTypeDefinitions().hasOwnProperty(a)},a.prototype.createProperty=function(b,c,d,e){Subclass.Tools.isPlainObject(c)||Subclass.Error.create("InvalidArgument").argument('the definition of property "'+b+'"',!1).received(c).expected('a plain object with mandatory property "type"').apply();var f=c.type;if(this.issetType(f)){var g=Subclass.Tools.copy(this.getTypeDefinition(f));f=g.type,c=Subclass.Tools.extendDeep(g,c),c.type=f}if(!a.issetPropertyType(f)){var h=(e&&e.getNameFull()+"."||"")+b;Subclass.Error.create('Trying to create property "'+h+'" of none existent type "'+f+'"'+(d&&' in class "'+d.getName()+'"')+".")}var i=a.getPropertyType(c.type),j=Subclass.Tools.createClassInstance(i,this,b,c);return j.setContextClass(d||null),j.setContextProperty(e||null),e||Subclass.Property.PropertyManager.isPropertyNameAllowed(b)||Subclass.Error.create('Trying to define property with not allowed name "'+b+'"'+(d&&' in class "'+d.getName()+'"'||"")+"."),j.initialize(),j},a._propertyTypes={},a._notAllowedPropertyNames=[],a.registerPropertyType=function(a){var b=a.getName();this._propertyTypes[b]=Subclass.Tools.buildClassConstructor(a)},a.getPropertyType=function(a){return this.issetPropertyType(a)||Subclass.Error.create('Trying to get non existed data type factory "'+a+'".'),this._propertyTypes[a]},a.getPropertyTypes=function(){return this._propertyTypes},a.issetPropertyType=function(a){return this._propertyTypes.hasOwnProperty(a)},a.registerNotAllowedPropertyNames=function(a){try{if(!Array.isArray(a))throw"error";for(var b=0;b<a.length;b++)if(this._notAllowedPropertyNames.indexOf(a[b])<0){if("string"!=typeof a[b])throw"error";this._notAllowedPropertyNames.push(a[b])}}catch(c){if("error"!=c)throw c;Subclass.Error.create("InvalidArgument").argument("the not allowed names of property",!1).received(a).expected("an array of strings").apply()}},a.getNotAllowedPropertyNames=function(){return this._notAllowedPropertyNames},a.isPropertyNameAllowed=function(a){if(a.match(/[^\$a-z0-9_]/i))return!1;for(var b=0;b<this._notAllowedPropertyNames.length;b++){var c=new RegExp("^_*"+this._notAllowedPropertyNames[b]+"_*$","i");if(c.test(a))return!1}return!0},a}(),Subclass.Property.PropertyType=function(){function a(a,b,c){a&&a instanceof Subclass.Property.PropertyManager||Subclass.Error.create("InvalidArgument").argument("the property manager instance",!1).expected('an instance of "Subclass.Property.PropertyManager" class').received(a).apply(),b&&"string"==typeof b||Subclass.Error.create("InvalidArgument").argument("the name of property",!1).received(c).expected("a string").apply(),c&&"object"==typeof c||Subclass.Error.create("InvalidArgument").argument("the definition of property",!1).received(c).expected("a plain object").apply(),this._propertyManager=a,this._name=b,this._data=c,this._contextClass=null,this._contextProperty=null}return a.$parent=null,a.getName=function(){Subclass.Error.create("NotImplementedMethod").method("getPropertyTypeName").className(this.name).apply()},a.getPropertyClass=function(){return Subclass.Property.Property},a.parseRelatedClasses=function(a){},a.getEmptyDefinition=function(){return{type:this.getName()}},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=4){var b={},c=!1;return a[0]&&(b.type=a[0]),a.length>=2&&(b["default"]=a[1],null===a[1]&&(c=!0)),a.length>=3&&(b.writable=a[2]),4==a.length&&(b.nullable=a[3]),c&&(b.nullable=!0),b}return a},a.prototype.initialize=function(){this.validateData(),this.processData()},a.prototype.getType=function(){return this.constructor.getName()},a.prototype.getPropertyManager=function(){return this._propertyManager},a.prototype.getName=function(){return this._name},a.prototype.getNameFull=function(){var a=this.getName(),b=this.getContextProperty(),c="";return b&&(c=b.getNameFull()),(c&&c+"."||"")+a},a.prototype.getData=function(){return this._data},a.prototype.setContextClass=function(a){this._contextClass=a},a.prototype.getContextClass=function(){return this._contextClass},a.prototype.setContextProperty=function(a){this._contextProperty=a},a.prototype.getContextProperty=function(){return this._contextProperty},a.prototype.createInstance=function(a){var b=this.constructor.getPropertyClass();return Subclass.Tools.createClassInstance(b,a,this)},a.prototype.generateGetter=function(a){return function(){return this.getProperty(a).getValue()}},a.prototype.generateSetter=function(a){return this.isWritable()?function(b){this.getProperty(a).setValue(b)}:function(){Subclass.Error.create("Property "+this.getProperty(a)+" is not writable.")}},a.prototype.attach=function(a,b){if(Object.isSealed(a)&&Subclass.Error.create("Can't attach property "+this+" because the context object is sealed."),this.isAccessors()){var c=Subclass.Tools.generateGetterName(b);if(a.hasOwnProperty(c)&&"function"==typeof a[c]&&(c+="Default"),a[c]=this.generateGetter(b),this.isWritable()){var d=Subclass.Tools.generateSetterName(b);a.hasOwnProperty(d)&&"function"==typeof a[d]&&(d+="Default"),a[d]=this.generateSetter(b)}}else Object.defineProperty(a,b,{configurable:!0,enumerable:!0,get:this.generateGetter(b),set:this.generateSetter(b)})},a.prototype.detach=function(a,b){if(Object.isSealed(a)){var c=a.getProperty(b);Subclass.Error.create("Can't detach property "+c+" because the context object is sealed.")}delete a[b]},a.prototype.validateValue=function(a){null!==a||this.isNullable()||Subclass.Error.create("The property "+this+" is not nullable.")},a.prototype.setValue=function(a){this.validateValue(a),this.getData().value=a},a.prototype.getValue=function(){return this.getData().value},a.prototype.getEmptyValue=function(){return this.isNullable()&&void 0==this.getDefault()?null:this.getDefault()},a.prototype.isValueEmpty=function(a){var b=this.getEmptyValue();return Subclass.Tools.isEqual(b,a)},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.setDefault=function(a){this.validateDefault(a),this.getData()["default"]=a},a.prototype.getDefault=function(){return this.getData()["default"]},a.prototype.validateDefaultless=function(a){"boolean"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("defaultless").property(this).received(a).expected("a boolean").apply()},a.prototype.setDefaultless=function(a){this.validateDefaultless(a),this.getData().defaultless=a},a.prototype.getDefaultless=function(){return this.getData().defaultless},a.prototype.isDefaultless=function(){return this.getDefaultless()},a.prototype.validateWatcher=function(a){null!==a&&"function"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("watcher").property(this).received(a).expected("a funciton or null").apply()},a.prototype.setWatcher=function(a){this.validateWatcher(a),this.getData().watcher=a},a.prototype.getWatcher=function(){return this.getData().watcher},a.prototype.validateAccessors=function(a){"boolean"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("accessors").received(a).property(this).expected("a boolean").apply()},a.prototype.setAccessors=function(a){this.validateAccessors(a),this.getData().accessors=a},a.prototype.getAccessors=function(){return this.getData().accessors},a.prototype.isAccessors=a.prototype.getAccessors,a.prototype.validateWritable=function(a){"boolean"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("writable").received(a).property(this).expected("a boolean").apply()},a.prototype.setWritable=function(a){this.validateWritable(a),this.getData().writable=a},a.prototype.getWritable=function(){return this.getData().writable},a.prototype.isWritable=function(){return this.getWritable()},a.prototype.validateNullable=function(a){"boolean"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("nullable").received(a).property(this).expected("a boolean").apply()},a.prototype.setNullable=function(a){this.validateNullable(a),this.getData().nullable=a},a.prototype.isNullable=function(){return this.getData().nullable},a.prototype.validateExtends=function(a){"boolean"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("extends").received(a).property(this).expected("a boolean").apply()},a.prototype.setExtends=function(a){this.validateExtends(a),this.getData()["extends"]=a},a.prototype.getExtends=function(){return this.getData()["extends"]},a.prototype.isExtends=function(){return this.getExtends()},a.prototype.getRequiredOptions=function(){return["type"]},a.prototype.getBaseData=function(){return{type:this.constructor.getName(),defaultless:!1,"default":void 0,value:void 0,writable:!0,watcher:null,accessors:!0,nullable:!0,"extends":!1}},a.prototype.validateData=function(){for(var a=this.getRequiredOptions(),b=this.getData(),c=0;c<a.length;c++){var d=a[c];b.hasOwnProperty(d)||Subclass.Error.create('Missed required option "'+d+'" in definition of the property '+this+".")}this.getWritable()===!1&&void 0!==this.getValue()&&console.warn('Specified "value" option for definition of not writable property '+this+'.\n The value in "value" option was ignored.\n The value from "default" option was applied instead.')},a.prototype.processData=function(){var a=Subclass.Tools.copy(this.getData()),b=!a.hasOwnProperty("default");this._data=this.getBaseData(),b&&void 0!==this.getDefault()&&(a["default"]=this.getDefault(),b=!1);for(var c in a)if(a.hasOwnProperty(c)&&"default"!=c&&"value"!=c){var d="set"+c[0].toUpperCase()+c.substr(1);this[d]&&this[d](a[c])}if(this.isNullable()&&this.isDefaultless()&&(b=!1,a["default"]=null),b)try{this.setDefault(this.getEmptyValue())}catch(e){console.error("The default value was not specified for property "+this+'. \nThe standard default value "'+this.getEmptyValue()+'" was used but it is not relevant. \nYou should specify appropriate default value or mark this property as nullable.'),Subclass.Error.create(e.message)}else this.setDefault(a["default"]);a.hasOwnProperty("value")&&this.setValue(a.value)},a.prototype.toString=function(){var a=this.getNameFull(),b=this.getContextClass()?' in the class "'+this.getContextClass().getName()+'"':"";return'definition "'+a+'"'+b},a}(),Subclass.Property.Property=function(){function a(a,b){a&&"string"==typeof a||Subclass.Error.create("InvalidError").argument("the name of property",!1).expected("a string").received(a).apply(),b&&b instanceof Subclass.Property.PropertyType||Subclass.Error.create("InvalidArgument").argument("the property definition",!1).expected('an instance of "Subclass.Property.PropertyType" class').received(b).apply(),this._name=a,this._definition=b,this._context=null,this._watchers=[],this._isModified=!1,this._isLocked=!1,this._value=void 0}return a.prototype.setName=function(a){this._name=a},a.prototype.getName=function(){return this._name},a.prototype.getType=function(){return this.getDefinition().constructor.getName()},a.prototype.getNameFull=function(){var a=this.getName(),b=this.getContext(),c="";return"property"==b.getContextType()&&(c=b.getProperty().getNameFull()),(c&&c+"."||"")+a},a.prototype.rename=function(a){var b=this.getContext(),c=this.isAttached();a&&"string"==typeof a||Subclass.Error.create("Specified invalid new value argument while was called method rename in property "+this+". It must be a string."),c&&Object.isSealed(b)&&Subclass.Error.create("Can't rename property "+this+". The context object is sealed.");var d=this.getDefinition(),e=this.getData();d.isAccessors()&&Subclass.Error.create("Can't rename property "+this+" because it uses accessor functions."),c&&(d.detach(b,this._name),d.attach(b,a)),this._name=a,this.setValue(e)},a.prototype.getDefinition=function(){return this._definition},a.prototype.validateContext=function(a){for(var b=["getProperty","issetProperty","getContextType"],c=0;c<b.length;c++)a&&"object"==typeof a&&"function"==typeof a[b[c]]||Subclass.Error.create("Trying to attach typed property "+this+' to invalid context object. The valid context object should implement methods: "'+b.join('", "')+".");return a},a.prototype.setContext=function(a){this.validateContext(a),this._context=a},a.prototype.getContext=function(){return this._context},a.prototype.modify=function(){var a=this.getContext(),b=a.getContextType();if("property"==b){var c=a.getProperty();c.modify()}this._isModified=!0},a.prototype.unModify=function(){this._isModified=!1},a.prototype.isModified=function(){return this._isModified},a.prototype.lock=function(){this._isLocked=!0},a.prototype.unlock=function(){this._isLocked=!1},a.prototype.isLocked=function(){if(this._isLocked)return!0;var a=this.getContext();if(a&&"property"==a.getContextType()){var b=a.getProperty();return b.isLocked()||!1}return!1},a.prototype.getWatchers=function(){var a=this.getDefinition().getWatcher(),b=[];return a&&b.push(a),Subclass.Tools.extend(b,this._watchers)},a.prototype.addWatcher=function(a){"function"!=typeof a&&Subclass.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply(),this.issetWatcher(a)||this._watchers.push(a)},a.prototype.issetWatcher=function(a){return this.getDefinition().getWatcher()==a?!0:this._watchers.indexOf(a)>=0},a.prototype.removeWatcher=function(a){var b;(b=this._watchers.indexOf(a))>=0&&this._watchers.splice(b,1),this.getDefinition().getWatcher()==a&&this.getDefinition().setWatcher(null)},a.prototype.removeWatchers=function(){this.getDefinition().setWatcher(null),this._watchers=[]},a.prototype.invokeWatchers=function(a){var b=this.getWatchers(),c=this.getContext();("object"!=typeof c||Array.isArray(c))&&Subclass.Error.create("InvalidArgument").argument("the context object",!1).received(c).expected("an object").apply();for(var d=0;d<b.length;d++)b[d].call(c,a)},a.prototype._createWatcherEvent=function(a,b){return Subclass.Tools.createClassInstance(Subclass.Property.WatcherEvent,this,a,b)},a.prototype._getParentWatcherValues=function(a,b){var c=a.getContext(),d=[];if(arguments[2]&&(d=arguments[2]),c&&c.getContextType&&"property"==c.getContextType()){var e=a.getContext().getProperty(),f=e.getData(),g=Subclass.Tools.copy(f);g[a.getName()]=b,d.push({property:e,newValue:g,oldValue:f}),this._getParentWatcherValues(e,g,d)}return d},a.prototype._invokeParentWatchers=function(a,b){for(var c=0;c<b.length&&!a.isPropagationStopped();c++){var d=b[c];a.setProperty(d.property),a.setNewValue(d.newValue),a.setOldValue(d.oldValue),d.property.invokeWatchers(a)}},a.prototype.isAttached=function(){var a=this.getContext();if(this.getDefinition().isAccessors()){var b=Subclass.Tools.generateGetterName(this.getName());if(void 0!==a[b])return!0}else if(void 0!==a[this.getName()])return!0;return!1},a.prototype.isEmpty=function(a){return arguments.length||(a=this.getValue()),this.getDefinition().isValueEmpty(a)},a.prototype.isValid=function(a){try{return this.getDefinition().validateValue(a),!0}catch(b){return!1}},a.prototype.setValue=function(a,b,c){if(b!==!1&&(b=!0),c!==!1&&(c=!0),this.isLocked())return console.warn("Trying to set new value for the property "+this+" that is locked for write.");var d=!1,e=[];if(b){var f=this.getData(),g=a,h=this._createWatcherEvent(g,f);d="function"==typeof g||!Subclass.Tools.isEqual(f,g),c&&(e=this._getParentWatcherValues(this,g)),d&&this.modify()}this.getDefinition().validateValue(a),this._value=a,d&&(this.invokeWatchers(h),c&&this._invokeParentWatchers(h,e))},a.prototype.getValue=function(){return this._value},a.prototype.resetValue=function(a){var b=this.getDefaultValue();this.setValue(b,a)},a.prototype.getData=function(){return this.getValue()},a.prototype.setDefaultValue=function(a){var b=this.getDefinition();b.setDefault(a),this.isDefaultValue()&&(this.setValue(a),this.unModify())},a.prototype.getDefaultValue=function(){return this.getDefinition().getDefault()},a.prototype.isDefaultValue=function(){var a=this.getDefaultValue(),b=this.getValue();return Subclass.Tools.isEqual(a,b)&&!this.isModified()||null===a&&this.isEmpty()&&!this.isModified()},a.prototype.toString=function(){var a=this.getNameFull(),b=this.getContext(),c="";return"class"==b.getContextType()&&(c=' in the class "'+b.getClassName()+'"'),'"'+a+'"'+c},a}(),Subclass.Error.Option.Property=function(){function a(){return{_property:void 0}}return a.prototype.property=function(a){if(!arguments.length)return this._property;if(a&&!(a instanceof Subclass.Property.PropertyType))throw new Error("Specified invalid property object. It must be an instance of Subclass.Property.PropertyType.");return this._property=a,this},a.prototype.hasProperty=function(){return void 0!==this._property},a}(),Subclass.Property.Error.InvalidPropertyOptionError=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Error.ErrorBase,a.$mixins=[Subclass.Error.Option.Option,Subclass.Error.Option.Property,Subclass.Error.Option.Expected,Subclass.Error.Option.Received],a.getName=function(){return"InvalidPropertyOption"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["property","option"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="Invalid value of option "+this.option()+" ",b+='in definition of property "'+this.property()+'". ',b+=this.hasExpected()?"It must be "+this.expected()+". ":"",b+=this.hasReceived()?this.received():""),b},Subclass.Error.registerType(a.getName(),a),a}(),Subclass.Property.Error.InvalidPropertyValueError=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Error.ErrorBase,a.$mixins=[Subclass.Error.Option.Property,Subclass.Error.Option.Expected,Subclass.Error.Option.Received],a.getName=function(){return"InvalidPropertyValue"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["property"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="Specified invalid value of property "+this.property()+". ",
b+=this.hasExpected()?"It must be "+this.expected()+". ":"",b+=this.hasReceived()?this.received():""),b},Subclass.Error.registerType(a.getName(),a),a}(),Subclass.Property.Extension.Class.ClassBuilderExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension;var b=Subclass.Class.ClassBuilder;return b.prototype._validateProperties=function(a){a&&Subclass.Tools.isPlainObject(a)||Subclass.Error.create("InvalidArgument").option("classProperties").received(a).expected("a plain object").apply()},b.prototype.setProperties=function(a){return this._validateProperties(a),this.getDefinition().$_properties=a,this},b.prototype.addProperties=function(a){return this._validateProperties(a),this.getDefinition().$_properties||(this.getDefinition().$_properties={}),Subclass.Tools.extend(this.getDefinition().$_properties,a),this},b.prototype.getProperties=function(){return this.getDefinition().$_properties||{}},b.prototype.removeProperty=function(a){return"string"!=typeof a&&Subclass.Error.create("InvalidArgument").argument("the name of property",!1).received(a).expected("a string").apply(),delete this.getDefinition().$_properties[a],this},Subclass.Module.onCreate(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Extension.Class.ClassDefinitionExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension,a.initialize=function(b){a.$parent.initialize.apply(this,arguments),b.getEvent("onGetBaseData").addListener(function(a,b){b.$_properties={}}),b.getEvent("onNormalizeData").addListener(function(a,b){if(b.hasOwnProperty("$_properties")&&Subclass.Tools.isPlainObject(b.$_properties)){b.$_properties=this.normalizeProperties(b.$_properties);for(var c in b.$_properties)if(b.$_properties.hasOwnProperty(c)){var d=b.$_properties[c];d&&Subclass.Tools.isPlainObject(d)||Subclass.Error.create('Specified invalid definition of property "'+c+'" in class "'+this.getClass().getName()+'".')}}}),b.getEvent("onValidateData").addListener(function(a,b){var c=this.getClass();for(var d in b)b.hasOwnProperty(d)&&(Subclass.Property.PropertyManager.isPropertyNameAllowed(d)||Subclass.Error.create('Trying to define property with not allowed name "'+d+'" in class "'+c.getName()+'".'))}),b.getEvent("onProcessRelatedClasses").addListener(function(a){var b=this.getClass(),c=b.getClassManager(),d=c.getModule().getPropertyManager(),e=this.getProperties();if(e&&Subclass.Tools.isPlainObject(e))for(var f in e)if(e.hasOwnProperty(f)){var g=d.normalizeTypeDefinition(e[f],f);if("object"==typeof g){var h=g.type;if(d.issetType(h)){var i=Subclass.Tools.copy(d.getTypeDefinition(h));h=i.type,g=Subclass.Tools.extendDeep(i,g),g.type=h}var j=Subclass.Property.PropertyManager.getPropertyType(h);if(j.parseRelatedClasses){var k=j.parseRelatedClasses(g);if(k&&k.length)for(var l=0;l<k.length;l++)c.load(k[l])}}}})};var b=Subclass.Class.ClassDefinition;return b.prototype.setRequires=function(a){this.validateRequires(a),this.getData().$_requires=a||null;var b=this.getClass();if(a&&Subclass.Tools.isPlainObject(a))for(var c in a)a.hasOwnProperty(c)&&b.addProperty(c,{type:"untyped",className:a[c]})},b.prototype.validateProperties=function(a){if(a&&"object"!=typeof a)Subclass.Error.create("InvalidClassOption").option("$_properties").received(a).className(this.getClass().getName()).expected("a plain object with property definitions").apply();else if(a)for(var b in a)a.hasOwnProperty(b)&&(Subclass.Property.PropertyManager.isPropertyNameAllowed(b)||Subclass.Error.create('Specified not allowed typed property name "'+b+'" in option "$_properties" in definition of class "'+this.getClass().getName()+'".'),a[b]&&Subclass.Tools.isPlainObject(a[b])||Subclass.Error.create("InvalidClassOption").option('"$_properties" (invalid definition of property "'+b+'")',!1).received(a).className(this.getClass().getName()).expected("a plain object with property definitions").apply(),a[b].type||Subclass.Error.create('Trying to set not valid definition of typed property "'+b+'" in option "$_properties" in definition of class "'+this.getClass().getName()+'". Required property "type" was missed.'));return!0},b.prototype.getPropertyNormalizers=function(){var a=this;return[function(b){if(a.getExtends&&a.getExtends()){{var c=a.getExtends(),d=a.getClass().getClassManager().get(c);d.getConstructor()}b=a.extendProperties(d.getDefinition().getProperties(),b)}return b}]},b.prototype.normalizeProperties=function(a){var b=this.getClass().getClassManager(),c=b.getModule().getPropertyManager();if(a&&Subclass.Tools.isPlainObject(a))for(var d in a)a.hasOwnProperty(d)&&(a[d]=c.normalizeTypeDefinition(a[d],d));for(var e=this.getPropertyNormalizers(),f=0;f<e.length;f++)a=e[f](a);return a},b.prototype.extendProperties=function(a,b){a=Subclass.Tools.copy(a);for(var c in b)b.hasOwnProperty(c)&&(Subclass.Tools.isPlainObject(b[c])&&b[c].hasOwnProperty("type")&&a&&a.hasOwnProperty(c)?b[c]["extends"]===!0?a[c]=Subclass.Tools.extend(a[c],b[c]):a[c]=b[c]:a&&a[c]?a[c]=Subclass.Tools.extend(a[c],{value:b[c]}):a[c]=b[c]);return a},b.prototype.setProperties=function(a){if(this.validateProperties(a),this.getData().$_properties=a||{},a)for(var b in a)a.hasOwnProperty(b)&&this.getClass().addProperty(b,a[b])},b.prototype.getProperties=function(){return this.getData().$_properties},Subclass.Module.onCreate(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Extension.Class.ClassTypeExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension,a.initialize=function(b){a.$parent.initialize.apply(this,arguments),b.getEvent("onInitialize").addListener(function(){this._properties={}}),b.getEvent("onCreateClassAfter").addListener(function(a,b){this.attachProperties(b.prototype)}),b.getEvent("onCreateInstanceBefore").addListener(function(a,b){var c=this.getProperties(!0);this.attachPropertyMethods(b);for(var d in c)if(c.hasOwnProperty(d)){var e=b.getProperty(d),f=c[d],g=f.getValue();void 0!==g&&e.setValue(g,!1)}}),b.getEvent("onCreateInstance").addListener(function(a,b){var c=this.getClassManager();if(b.$_requires&&Subclass.Tools.isPlainObject(b.$_requires))for(var d in b.$_requires)if(b.$_requires.hasOwnProperty(d)){var e=Subclass.Tools.generateSetterName(d),f=b.$_requires[d],g=c.get(f);b[e](g)}})};var b=Subclass.Class.ClassType;return b.prototype.getProperties=function(a){var b={};if(a!==!0&&(a=!1),a&&this.hasParent()){var c=this.getParent(),d=c.getProperties(a);Subclass.Tools.extend(b,d)}return Subclass.Tools.extend(b,this._properties)},b.prototype.addProperty=function(a,b){var c=this.getClassManager().getModule().getPropertyManager();this._properties[a]=c.createProperty(a,b,this)},b.prototype.getProperty=function(a){var b=this.getProperties();return!b[a]&&this.hasParent()?this.getParent().getProperty(a):(b[a]||Subclass.Error.create('Trying to call to non existent property "'+a+'" in class "'+this.getName()+'".'),this.getProperties()[a])},b.prototype.issetProperty=function(a){var b=this.getProperties();return!b[a]&&this.hasParent()?this.getParent().issetProperty(a):b[a]?!0:!1},b.prototype.attachProperties=function(a){if(this.getProperties){var b=this.getProperties();for(var c in b)b.hasOwnProperty(c)&&b[c].attach(a,c)}},b.prototype.attachPropertyMethods=function(a){if(this.getProperties){var b=this.getProperties(!0),c={};a.getProperty=function(a){return c[a]},a.issetProperty=function(a){return c.hasOwnProperty(a)},a.getContextType=function(){return"class"};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d].createInstance(d),c[d].setContext(a),c[d].resetValue(!1))}},Subclass.Module.onCreate(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||(b.registerExtension(a),Subclass.Property.PropertyManager.registerNotAllowedPropertyNames(["class","parent","classManager","class_manager","classWrap","class_wrap","className","class_name"]))}),a}(),Subclass.Property.Extension.Class.Type.AbstractClass.AbstractClassDefinitionExtension=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Extension,a.initialize=function(b){a.$parent.initialize.apply(this,arguments),b.getEvent("onGetBaseData").addListener(function(a,b){delete b.issetProperty,delete b.getProperty})},Subclass.Module.onInitializeBefore(function(b,c){if(Subclass.ClassManager.issetType("AbstractClass")){var d=Subclass.ClassManager.getType("AbstractClass").getDefinitionClass();d=Subclass.Tools.buildClassConstructor(d),d.hasExtension(a)||d.registerExtension(a)}}),a}(),Subclass.Property.Extension.Class.Type.Class.ClassDefinitionExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Class.ClassExtension,a.$config={classes:["Class"]},a.initialize=function(b){var c=this.getConfig().classes;return c.indexOf(b.getClass().getType())<0?!1:(a.$parent.initialize.apply(this,arguments),void b.getEvent("onGetBaseData").addListener(function(a,b){b._getDataTypeProperty=function(a){var b,c=this.getClassManager(),d=c.getModule().getPropertyManager();return a&&"object"==typeof a&&a.type&&"string"==typeof a.type?d.createProperty("test",a).getAPI(this):(a&&"string"==typeof a||Subclass.Error.create("InvalidArgument").argument("the data type",!1).received(a).expected("a string").apply(),this.issetProperty(a)?b=this.getProperty(a):this.issetType(a)&&(b=this.getType(a).getAPI(this)),b||Subclass.Error.create("Specified non existent or data type which can't be used in data type validation."),b)},b.value=function(a,b,c){var d=this._getDataTypeProperty(a);return a="object"==typeof a?a.type:a,void 0===b&&3==arguments.length?c:void 0===b?d.getDefaultValue():(d.isValueValid(b)||Subclass.Error.create('Specified invalid value that is not corresponds to data type "'+a+'".'),b)},b.result=function(a,b){var c=this._getDataTypeProperty(a);return a="object"==typeof a?a.type:a,c.isValueValid(b)||Subclass.Error.create('Trying to return not valid value that is not corresponds to data type "'+a+'".'),b}}))};var b=Subclass.Class.Type.Class.ClassDefinition;return b.prototype.getPropertyNormalizers=function(){var a=b.$parent.prototype.getPropertyNormalizers.apply(this,arguments),c=this;return a.unshift(function(a){if(!c.getTraits)return a;var b=c.getTraits();if(!b)return a;for(var d=0;d<b.length;d++){var e=b[d],f=c.getClass().getClassManager().get(e),g=(f.getConstructor(),f.getDefinition().getProperties());a=c.extendProperties(g,a)}return a}),a},Subclass.Module.onInitializeBefore(function(b,c){var d=Subclass.ClassManager.getType("Class").getDefinitionClass();d=Subclass.Tools.buildClassConstructor(d),d.hasExtension(a)||d.registerExtension(a)}),a}(),Subclass.Property.Extension.Class.Type.Interface.InterfaceBuilderExtension=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Extension,Subclass.Module.onInitializeBefore(function(a,b){if(Subclass.ClassManager.issetType("Interface")){var c=Subclass.ClassManager.getType("Interface").getBuilderClass();c.prototype.setProperties=void 0,c.prototype.addProperties=void 0,c.prototype.getProperties=void 0,c.prototype.removeProperty=void 0}}),a}(),Subclass.Property.Extension.Class.Type.Interface.InterfaceExtension=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Extension,Subclass.Module.onInitializeBefore(function(a,b){if(Subclass.ClassManager.issetType("Interface")){var c=Subclass.ClassManager.getType("Interface");c.prototype.setProperties=void 0,c.prototype.addProperties=void 0,c.prototype.getProperties=void 0,c.prototype.removeProperty=void 0,c.prototype.attachProperties=function(){}}}),a}(),Subclass.Property.Extension.Class.Type.Trait.TraitExtension=function(){function a(b){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Extension,Subclass.Module.onInitializeBefore(function(a,b){if(Subclass.ClassManager.issetType("Trait")){var c=Subclass.ClassManager.getType("Trait");c.prototype.attachProperties=function(){},c.prototype.getProperties=function(){var a={};if(this.hasParent()){var b=this.getParent(),c=b.getProperties();a=Subclass.Tools.extend(a,c)}return Subclass.Tools.extend(a,this._properties)}}}),a}(),Subclass.Property.Extension.ModuleAPIExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension;var b=Subclass.ModuleAPI;return b.prototype.getPropertyManager=function(){return this.getModule().getPropertyManager.apply(this.getModule(),arguments)},b.prototype.registerDataTypes=function(){return this.getModule().getConfigManager().setDataTypes.apply(this.getModule().getConfigManager(),arguments)},b.prototype.onConfig=function(){return this.getModule().onConfig.apply(this.getModule(),arguments)},b.prototype.setConfigsClass=function(){return this.getModule().setConfigsClass.apply(this.getModule(),arguments)},b.prototype.getConfigsClass=function(){return this.getModule().getConfigsClass.apply(this.getModule(),arguments)},b.prototype.issetConfigsClass=function(){return this.getModule().issetConfigsClass.apply(this.getModule(),arguments)},Subclass.Module.onInitializeBefore(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Extension.ModuleExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension,a.initialize=function(a){this.$parent.initialize.apply(this,arguments);var b=a.getEventManager();b.registerEvent("onConfig"),b.getEvent("onInitialize").addListener(function(a,b){this._propertyManager=Subclass.Tools.createClassInstance(Subclass.Property.PropertyManager,this),this._configsClassName=null}),b.getEvent("onInitializeAfter").addListener(function(a,b){this.getPropertyManager().initialize()}),b.getEvent("onLoadingEnd").addListener(function(){if(a.isRoot()){var b=a.getServiceManager();b.register("configs"),b.register("config_container")}})};var b=Subclass.Module;return b.prototype.getPropertyManager=function(){return this._propertyManager},b.prototype.onConfig=function(a){return this.getSettingsManager().setOnConfig(a),this},b.prototype.triggerOnConfig=function(a){return a&&"object"==typeof a&&a.getClassType&&"Config"==a.getClassType()||Subclass.Error.create("InvalidArgument").argument("the configs instance",!1).expected("an instance of Config class type").received(a).apply(),this.getEventManager().getEvent("onConfig").trigger(a),this},b.prototype.setConfigsClass=function(a){a&&"string"==typeof a&&this.getClassManager().isset(a)||Subclass.Error.create("InvalidError").argument("the name of module configuration class",!1).expected("a string").received(a).apply(),this._configsClassName=a},b.prototype.getConfigsClass=function(){var a=this._configsClassName;return a||Subclass.Error.create("Trying to get configs class before it was defined."),this.getClassManager().get(a)},b.prototype.issetConfigsClass=function(){return!!this._configsClassName},Subclass.Module.onInitializeBefore(function(c,d){b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Extension.ModuleInstanceExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension,a.initialize=function(b){a.$parent.initialize.apply(this,arguments),b.getEvent("onInitialize").addListener(function(){this._configContainer=Subclass.Tools.createClassInstance(Subclass.Property.ConfigContainer,this),this._configContainer.initialize()})};var b=Subclass.ModuleInstance;return b.prototype.getConfigContainer=function(){return this._configContainer},Subclass.Module.onInitializeBefore(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Extension.SettingsManagerExtension=function(){function a(b){a.$parent.apply(this,arguments)}a.$parent=Subclass.Extension,a.initialize=function(b){a.$parent.initialize.apply(this,arguments),b.getEvent("onInitialize").addListener(function(){this._configs={}})};var b=Subclass.SettingsManager;return b.prototype.setConfigs=function(a){a&&(Subclass.Tools.isPlainObject(a)||Subclass.Error.create("InvalidArgument").argument("the module configuration values",!1).expected("a plain object").received(a).apply(),this._configs=a)},b.prototype.getConfigs=function(a){var b=this.getModule(),c=b.getModuleStorage(),d={},e=this;return a!==!0&&(a=!1),a||!c?this._configs:(c.eachModule(function(a){if(a==b)return void Subclass.Tools.extendDeep(d,e.getConfigs(!0));var c=a.getSettingsManager(),f=c.getConfigs();Subclass.Tools.extendDeep(d,f)}),d)},b.prototype.setOnConfig=function(a){this.checkModuleIsReady(),"function"!=typeof a&&Subclass.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this.getModule().getEventManager(),c=b.getEvent("onConfig");c.addListener(a)},b.prototype.setDataTypes=function(a){this.checkModuleIsReady(),this.getModule().getPropertyManager().addTypeDefinitions(a)},b.prototype.getDataTypes=function(){return this.getModule().getPropertyManager().getTypeDefinitions()},Subclass.Module.onInitializeBefore(function(c,d){b=Subclass.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),Subclass.Property.Type.Map={},Subclass.Property.Type.Map.MapType=function(){function a(){a.$parent.apply(this,arguments),this._children={}}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"map"},a.getPropertyClass=function(){return Subclass.Property.Type.Map.MapProperty},a.parseRelatedClasses=function(a){if(a.schema){var b=[];for(var c in a.schema)if(a.schema.hasOwnProperty(c)&&"object"==typeof a.schema[c]&&a.schema[c].type){var d=a.schema[c],e=Subclass.Property.PropertyManager.getPropertyType(d.type);if(e.parseRelatedClasses){var f=e.parseRelatedClasses(d);f&&f.length&&(b=b.concat(f))}}return b}},a.getEmptyDefinition=function(){return!1},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=5){var b={},c=!1;return a[0]&&(b.type=a[0]),a.length>=2&&(b.schema=a[1]),a.length>=3&&(b["default"]=a[2],null===a[2]&&(c=!0)),a.length>=4&&(b.writable=a[3]),5==a.length&&(b.nullable=a[4]),c&&(b.nullable=!0),b}return a},a.prototype.getChildren=function(){return this._children},a.prototype.addChild=function(a,b){return b.accessors=!1,this._children[a]=this.getPropertyManager().createProperty(a,b,this.getContextClass(),this)},a.prototype.getChild=function(a){return this._children[a]},a.prototype.hasChild=function(a){return this._children.hasOwnProperty(a)},a.prototype.validateValue=function(b){a.$parent.prototype.validateValue.call(this,b);var c=!1;if(!b||"object"==typeof b&&Subclass.Tools.isPlainObject(b)||(c=!0),!c)for(var d in b)if(b.hasOwnProperty(d))if(this.hasChild(d))this.getChild(d).validateValue(b[d]);else{var e=this.getChildren();Subclass.Error.create('Trying to set not registered property "'+d+'" to not extendable map property '+this+'. Allowed properties are: "'+Object.keys(e).join('", "')+'".')}c&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a plain object").apply()},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.setDefault=function(b){if(a.$parent.prototype.setDefault.call(this,b),null!==b)for(var c in b)b.hasOwnProperty(c)&&this.getChild(c).setDefault(b[c])},a.prototype.validateSchema=function(a){a&&"object"==typeof a&&Subclass.Tools.isPlainObject(a)||Subclass.Error.create("InvalidPropertyOption").option("schema").property(this).received(a).expected("a plain object with definitions of properties").apply()},a.prototype.setSchema=function(a){this.validateSchema(a),this.getData().schema=a;var b=this.getPropertyManager();for(var c in a)a.hasOwnProperty(c)&&(a[c]=b.normalizeTypeDefinition(a[c],c),this.isWritable()||(a[c].writable=!1),this.addChild(c,a[c]))},a.prototype.getSchema=function(){return this.getData().schema},a.prototype.getRequiredAttributes=function(){var b=a.$parent.prototype.getRequiredAttributes.call(this);return b.concat(["schema"])},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.call(this);return b.schema=null,b["default"]={},b},a.prototype.validateData=function(){a.$parent.prototype.validateData.apply(this,arguments);var b=this.getSchema();if(b&&Subclass.Tools.isPlainObject(b))for(var c in b)b.hasOwnProperty(c)&&b[c].hasOwnProperty("value")&&console.warn('Specified "value" option for definition of property '+this+' was ignored.\n The value from "default" attribute was applied instead.')},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Map.Map=function(){function a(){}return a.prototype.getProperty=function(a){Subclass.Error.create("NotImplementedMethod").className("Subclass.Property.Type.Map.Map").method("getProperty").apply()},a.prototype.issetProperty=function(a){return this.getChildren().hasOwnProperty(a)},a.prototype.getContextType=function(){return"property"},a.prototype.forEach=function(a){var b=this.getChildren();for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a.call(this,d.getValue(),c,d)}},a.prototype.getChildren=function(){return this.getProperty().getChildren()},a.prototype.setValue=function(a){return this.getProperty().setValue(a)},a.prototype.getValue=function(){return this},a.prototype.getData=function(){return this.getProperty().getData()},a.prototype.toString=function(){return this.getData().toString()},a.prototype.valueOf=function(){return this.getData()},a}(),Subclass.Property.Type.Map.MapProperty=function(){function a(){a.$parent.apply(this,arguments),this._children={};var b=this.getDefinition().getChildren();for(var c in b)b.hasOwnProperty(c)&&(this._children[c]=b[c].createInstance(c))}return a.$parent=Subclass.Property.Property,a.prototype.setChildren=function(a){Object.isSealed(this)&&Subclass.Error.create("The property "+this.getProperty()+" is sealed so you can't change its children.");try{if(!a||"object"!=typeof a)throw new Error;for(var b in a)if(a.hasOwnProperty(b)&&!(a[b]instanceof Subclass.Property.Property))throw new Error}catch(c){Subclass.Error.create("InvalidArgument").argument("the map children collection",!1).expected('an object with instances of class "Subclass.Property.Property"').received(a).apply()}this._children=a},a.prototype.getChildren=function(){return this._children},a.prototype.getChild=function(a){return this._children[a]},a.prototype.getDefaultValue=function(){if(null===this.getDefinition().getDefault())return null;var a=this.getChildren(),b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c].getDefaultValue());return b},a.prototype.setValue=function(a,b,c){if(b!==!1&&(b=!0),c!==!1&&(c=!0),this.isLocked())return console.warn("Trying to set new value for the property "+this+" that is locked for write.");var d,e=this.getValue(),f=[];if(b){var g=this.getData(),h=a,i=this._createWatcherEvent(h,g);d="function"==typeof h||!Subclass.Tools.isEqual(g,h),c&&(f=this._getParentWatcherValues(this,h)),d&&this.modify()}if(this.getDefinition().validateValue(a),null!==a){e||(this._value=e=this.createMap());for(var j in a)a.hasOwnProperty(j)&&e.getProperty(j).setValue(a[j],b,!1)}else this._value=null;d&&(this.invokeWatchers(i),c&&this._invokeParentWatchers(i,f))},a.prototype.resetValue=function(a){a!==!1&&(a=!0),a&&this.modify();var b=this.getDefaultValue();null!==b&&(b=this.createMap()),this._value=b},a.prototype.createMap=function(){function a(){return a.name}var b=this;a.$parent=Subclass.Property.Type.Map.Map,a.prototype.getProperty=function(a){return arguments.length?this.getChildren()[a]:b};var c=Subclass.Tools.createClassInstance(a),d=this.getChildren();for(var e in d)d.hasOwnProperty(e)&&(d[e].getDefinition().attach(a.prototype,e),d[e].setContext(c),d[e].resetValue(!1));return Object.seal(c),c},a.prototype.getData=function(){var a=this.getValue();if(null===a)return null;var b=this.getChildren(),c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d].getData());return c},a}(),Subclass.Property.Type.Collection={},Subclass.Property.Type.Collection.ArrayCollection={},Subclass.Property.Type.Collection.ObjectCollection={},Subclass.Property.Type.Collection.CollectionType=function(){function a(){a.$parent.apply(this,arguments),this._protoInst=null}return a.$parent=Subclass.Property.PropertyType,a.parseRelatedClasses=function(a){if(a.proto&&"object"==typeof a.proto&&a.proto.type){var b=a.proto,c=Subclass.Property.PropertyManager.getPropertyType(b.type);if(c.parseRelatedClasses)return c.parseRelatedClasses(b)}},a.getEmptyDefinition=function(){return!1},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=5){var b={},c=!1;return a[0]&&(b.type=a[0]),a.length>=2&&(b.proto=a[1]),a.length>=3&&(b["default"]=a[2],null===a[2]&&(c=!0)),a.length>=4&&(b.writable=a[3]),5==a.length&&(b.nullable=a[4]),c&&(b.nullable=!0),b}return a},a.prototype.getProtoInstance=function(){return this._protoInst},a.prototype.validateProto=function(a){a&&"object"==typeof a||Subclass.Error.create("InvalidPropertyOption").option("proto").received(a).property(this).expected("a plain object").apply()},a.prototype.setProto=function(a){var b=this.getPropertyManager();a=b.normalizeTypeDefinition(a),this.validateProto(a),this.getData().proto=a,a.accessors=!1,this.isWritable()||(a.writable=!1),this._protoInst=b.createProperty("collectionItem",a,this.getContextClass(),this)},a.prototype.getProto=function(){return this.getData().proto},a.prototype.getRequiredAttributes=function(){var b=a.$parent.prototype.getRequiredAttributes.apply(this,arguments);return b.concat(["proto"])},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.proto=null,b},a}(),Subclass.Property.Type.Collection.Collection=function(){function a(a){a&&a instanceof Subclass.Property.Property||Subclass.Error.create("InvalidArgument").argument("the property instance",!1).received(a).expected('an instance of "Subclass.Property.Property" class').apply(),this._property=a,this._items=null,this._allowModifying=!0,this._resetItems()}return a.getCollectionItemsClass=function(){return Subclass.Property.Type.Collection.CollectionItems},a.prototype._resetItems=function(){var a=this.constructor.getCollectionItemsClass();this._items=Subclass.Tools.createClassInstance(a,this)},a.prototype.isAllowsModifying=function(){return this._allowModifying},a.prototype.allowModifying=function(){this._allowModifying=!0},a.prototype.denyModifying=function(){this._allowModifying=!1},a.prototype._validateItems=function(a){return Subclass.Tools.isPlainObject(a)||Subclass.Error.create("InvalidArgument").argument("the items in object collection "+this._property,!1).received(a).expected("a plain object").apply(),!0},a.prototype.add=function(a,b){return this.isset(a)?(console.warn('Trying to add already existent collection item with key "'+a+'" to property '+this._property+"."),!1):(this._property.getDefinition().getProtoInstance().validateValue(b),this._items.attach(a,b),this.isAllowsModifying()&&this._property.modify(),this._items.get(a))},a.prototype.addItems=function(a){this._validateItems(a);for(var b in a)a.hasOwnProperty(b)&&this.add(b,a[b])},a.prototype.set=function(a,b){return this.isset(a)?this._items.get(a).setValue(b,this.isAllowsModifying()):(this._property.getDefinition().getProtoInstance().validateValue(b),this._items.attach(a,b)),this.isAllowsModifying()&&this._property.modify(),this._items.get(a)},a.prototype.setItems=function(a){this._validateItems(a);for(var b in a)a.hasOwnProperty(b)&&this.set(b,a[b])},a.prototype.replaceItems=function(a){this._validateItems(a),this.removeItems(),this.setItems(a)},a.prototype.get=function(a){return this.isset(a)||Subclass.Error.create('Trying to get non existent collection item with key "'+a+'" in property '+this._property+"."),this._items.get(a).getValue()},a.prototype.remove=function(a){var b=this._items.get(a).getData();return this._items.remove(a),this.isAllowsModifying()&&this._property.modify(),b},a.prototype.removeItems=function(){var a=this.getData();return this._resetItems(),this.isAllowsModifying()&&this._property.modify(),a},a.prototype.isset=function(a){return this._items.isset(a)},a.prototype.forEach=function(a){2==arguments.length&&"function"==typeof arguments[1]&&(a=arguments[1]),"function"!=typeof a&&Subclass.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this._items.getItems();for(var c in b)if(b.hasOwnProperty(c)&&a(b[c].getValue(),c)===!1)break},a.prototype.indexOf=function(a,b){var c="function"==typeof a?a:!1,d=null;return b!==!0&&(b=!1),this.forEach(b,function(b,e){return c&&c(b,e)===!0||!c&&a==b?(d=e,!1):void 0}),d},a.prototype.filter=function(a){a&&"function"==typeof a||Subclass.Error.create("InvalidArgument").argument("the testing callback",!1).received(a).expected("a function").apply();var b={};return this.forEach(function(c,d){a(c,d)===!0&&(b[d]=c)}),b},a.prototype.find=function(a){var b=this._items;return this.filter(function(c,d){if(Subclass.Tools.isPlainObject(a)){for(var e in a)if(!a.hasOwnProperty(e)||b.get(d).getData()[e]!=a[e])return!1;return!0}return Subclass.Tools.isEqual(b.get(d).getData(),a)?!0:!1})},a.prototype.getLength=function(){return this._items.getLength()},a.prototype.getData=function(){Subclass.Error.create("NotImplementedMethod").className("Subclass.Property.Type.Collection.Collection").method("getData").apply()},a.prototype.toString=function(){return this.getData().toString()},a.prototype.valueOf=function(){return this.getData()},a}(),Subclass.Property.Type.Collection.CollectionItems=function(){function a(a){a&&a instanceof Subclass.Property.Type.Collection.Collection||Subclass.Error.create("InvalidArgument").argument("the collection instance",!1).received(a).expected('an instance of "Subclass.Property.Type.Collection.Collection"').apply(),this._collection=a,this._items={}}return a.prototype={getProperty:function(a){return arguments.length?this._items[a]:this._collection._property},issetProperty:function(a){return this.getItems().hasOwnProperty(a)},getContextType:function(){return"property"},attach:function(a,b){var c=this._collection._property.getDefinition().getProtoInstance();this._items[a]=c.createInstance(a),this._items[a].setContext(this),this._items[a].resetValue(!1),void 0!==b&&this._items[a].setValue(b,!1)},getItems:function(){return this._items},get:function(a){return this.getProperty(a)},isset:function(a){return this.issetProperty(a)},remove:function(a){delete this.getItems()[a]},removeItems:function(){var a=this.getItems();for(var b in a)a.hasOwnProperty(b)&&this.remove(b)},getLength:function(){return Object.keys(this.getItems()).length}},a}(),Subclass.Property.Type.Collection.CollectionProperty=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Property,a.getCollectionClass=function(){return Subclass.Property.Type.Collection.Collection},a.prototype={getDefaultValue:function(){var a=this.getDefinition().getDefault();return Subclass.Tools.isEmpty(a)||(a=this.createCollection().getData()),a},setValue:function(a,b,c){if(b!==!1&&(b=!0),c!==!1&&(c=!0),this.isLocked())return console.warn("Trying to set new value for the property "+this+" that is locked for write.");var d,e=this.getValue(),f=[];if(b){var g=this.getData(),h=a,i=this._createWatcherEvent(h,g);d="function"==typeof h||!Subclass.Tools.isEqual(g,h),c&&(f=this._getParentWatcherValues(this,h)),d&&this.modify()}this.getDefinition().validateValue(a),null!==a?(e||(this._value=e=this.createCollection()),b||e.denyModifying(),e.replaceItems(a),b||e.allowModifying()):this._value=null,d&&(this.invokeWatchers(i),c&&this._invokeParentWatchers(i,f))},resetValue:function(a){a!==!1&&(a=!0);var b=this.getDefaultValue();null!==b&&(b=this.createCollection()),a&&this.modify(),this._value=b},createCollection:function(){var a=this.constructor.getCollectionClass(),b=Subclass.Tools.createClassInstance(a,this);return this.initializeCollection(b),Object.seal(b),b},initializeCollection:function(a){var b=this.getDefinition(),c=b.getDefault();

a.denyModifying(),null!==c&&a.addItems(c),a.allowModifying(),Object.defineProperty(a,"length",{enumerable:!1,set:function(){},get:function(){return a.getLength()}})},getData:function(){var a=this.getValue();return null!==a?a.getData():null}},a}(),Subclass.Property.Type.Collection.ArrayCollection.ArrayCollection=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.Collection,a.prototype._validateItems=function(a){return Array.isArray(a)||Subclass.Error.create("InvalidArgument").argument("the collection items for property "+this._property,!1).received(a).expected("an array").apply(),!0},a.prototype.addItems=function(a){Array.isArray(a)||Subclass.Error.create("InvalidArgument").argument("the items for array collection in property "+this._property,!1).received(a).expected("an array").apply();for(var b in a)a.hasOwnProperty(b)&&this.add(a[b])},a.prototype.add=function(a){2==arguments.length&&(a=arguments[1]),arguments.length&&this._property.getDefinition().getProtoInstance().validateValue(a);var b=String(this.getLength());return this._items.attach(b,a),this.isAllowsModifying()&&this._property.modify(),this._items.get(b)},a.prototype.setItems=function(a){Array.isArray(a)||Subclass.Error.create("InvalidArgument").argument("the items for array collection in property "+this._property,!1).received(a).expected("an array").apply();for(var b=0;b<a.length;b++)this.isset(b)?this.set(b,a[b]):this.add(a[b])},a.prototype.set=function(b,c){if(b=parseInt(b),isNaN(b)&&Subclass.Error.create("InvalidArgument").argument("the index of array collection item",!1).received(b).expected("a number").apply(),this.length<b)for(var d=this.length;b>d;d++)this.add();return a.$parent.prototype.set.call(this,String(b),c)},a.prototype.get=function(a){return this.isset(a)||Subclass.Error.create('Trying to get non existent array element with index "'+a+'" in property '+this._property+"."),this._items.get(a).getValue()},a.prototype.removeItems=function(b,c){if(!arguments.length)return a.$parent.prototype.removeItems.call(this);if(this.isset(b)){1==arguments.length&&(c=this.length),0>c&&Subclass.Error.create("InvalidArgument").argument("the length of items to remove",!1).expected("a positive number").received(c).apply();var d,e=b+c-1;if(e>=this.length-1)for(d=this.length-1;d>=b;d--)this.remove(d);else for(d=0;c>d;d++)this.remove(b);this.isAllowsModifying()&&this._property.modify()}},a.prototype.remove=function(b){b=parseInt(b);var c=this._items.getItems(),d=this.length,e=this,f=!1;return this.forEach(function(d,g){if(g==b)f=a.$parent.prototype.remove.call(e,b);else if(g>b){var h=String(g-1),i=e._items.get(g);i.rename(h),c[h]=i}}),this.length==d&&this.pop(),this.isAllowsModifying()&&this._property.modify(),f},a.prototype.isset=function(a){return isNaN(parseInt(a))&&Subclass.Error.create("InvalidArgument").argument("the index of array collection item",!1).received(a).expected("a number").apply(),this._items.isset(String(a))},a.prototype.push=a.prototype.add,a.prototype.pop=function(){var a=this.length;return a?this.remove(a-1):null},a.prototype.shift=function(){var a=this.length;return a?this.remove(0):null},a.prototype.unshift=function(a){var b=this._items.getItems(),c=this;this.forEach(!0,function(a,d){var e=String(d+1),f=c._items.get(d);f.rename(e),b[e]=f}),delete c._items.remove(0),this.set(0,a)},a.prototype.indexOf=function(b,c){var d=a.$parent.prototype.indexOf.call(this,b,c);return null===d?-1:parseInt(d)},a.prototype.lastIndexOf=function(a){return this.indexOf(a,!0)},a.prototype.join=function(a){var b=this.getData();return b.join.apply(b,arguments)},a.prototype.swap=function(a,b){var c=this._items.getItems(),d=this.getLength(),e=this._items.get(a);e.rename(String(d)),c[d]=e;var f=this._items.get(b);f.rename(String(a)),c[a]=f;var g=this._items.get(d);g.rename(String(b)),c[b]=g,this.remove.call(this,d)},a.prototype.reverse=function(){var a=this.getLength(),b=Math.ceil(a/2),c=this;this.forEach(function(d,e){if(e>=b)return!1;var f=a-e-1;c.swap(e,f)})},a.prototype.sort=function(a){var b=[],c=[],d=[];this.forEach(function(a,d){b[d]=a,c[d]=a}),b.sort.apply(b,arguments);for(var e=0;e<b.length;e++){var f=e,g=c.indexOf(b[e]);d.indexOf(f)>=0||d.indexOf(g)>=0||(d.push(f),d.push(g),this.swap(f,g))}},a.prototype.slice=function(a,b){var c=[];return this.forEach(function(a,b){c[b]=a}),c.slice.apply(c,arguments)},a.prototype.filter=function(a){a&&"function"==typeof a||Subclass.Error.create("InvalidArgument").argument("the testing callback",!1).received(a).expected("a function").apply();var b=[];return this.forEach(function(c,d){a(c,d)===!0&&b.push(c)}),b},a.prototype.forEach=function(a,b){"function"==typeof a&&(b=a),"function"!=typeof b&&Subclass.Error.create("InvalidArgument").argument("the callback",!1).received(b).expected("a function").apply(),a!==!0&&(a=!1);var c=Object.keys(this._items.getItems()),d=this;c.sort(),a&&c.reverse(),c.every(function(a){return b(d._items.get(a).getValue(),parseInt(a))===!1?!1:!0})},a.prototype.getData=function(){var a=[],b=this;return this.forEach(function(c,d){a[d]=b._items.get(d).getData()}),a},a}(),Subclass.Property.Type.Collection.ArrayCollection.ArrayCollectionProperty=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.CollectionProperty,a.getCollectionClass=function(){return Subclass.Property.Type.Collection.ArrayCollection.ArrayCollection},a}(),Subclass.Property.Type.Collection.ArrayCollection.ArrayCollectionType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.CollectionType,a.getName=function(){return"arrayCollection"},a.getPropertyClass=function(){return Subclass.Property.Type.Collection.ArrayCollection.ArrayCollectionProperty},a.prototype.validateValue=function(b){a.$parent.prototype.validateValue.apply(this,arguments),null!==b&&(b&&"object"==typeof b&&Array.isArray(b)||Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("an array").apply())},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]=[],b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Collection.ObjectCollection.ObjectCollection=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.Collection,a.prototype.add=function(b,c,d){var e;return b&&"string"==typeof b||Subclass.Error.create("InvalidArgument").argument("the key of object collection item",!1).expected("a string").received(b).apply(),arguments.length<2&&Subclass.Error.create("Method Subclass.Property.Type.Collection.ObjectCollection.ObjectCollection#add requires at least two arguments."),(e=a.$parent.prototype.add.apply(this,arguments))===!1?!1:(d!==!1&&this.normalize(b),e)},a.prototype.addItems=function(a){this._validateItems(a);for(var b in a)a.hasOwnProperty(b)&&this.add(b,a[b],!1);this.normalizeItems()},a.prototype.set=function(b,c,d){return a.$parent.prototype.set.apply(this,arguments)===!1?!1:(d!==!1&&this.normalize(b),this._items.get(b))},a.prototype.setItems=function(a){this._validateItems(a);for(var b in a)a.hasOwnProperty(b)&&this.set(b,a[b],!1);this.normalizeItems()},a.prototype.normalizeItems=function(){var a=this;this.forEach(function(b,c){a.normalize(c)})},a.prototype.normalize=function(a){function b(a,c){if("map"==a.getType()){var d=a.getChildren();for(var e in d)d.hasOwnProperty(e)&&(d[e].isDefaultValue()?delete c[e]:b(d[e],c[e]))}}var c=this._items.get(a).getData();if("map"!=this._property.getDefinition().getProto().type||!c["extends"])return c;this.isset(c["extends"])||Subclass.Error.create('Trying to extend object collection element "'+a+'" by non existent another collection element with key "'+c["extends"]+'".');var d=Subclass.Tools.copy(this.normalize(c["extends"]));delete c["extends"];for(var e in c)if(c.hasOwnProperty(e)){var f=this._items.get(a).getChild(e);f.isDefaultValue()?delete c[e]:b(f,c[e])}return c=Subclass.Tools.extendDeep(d,c),this.set(a,c),c},a.prototype.keys=function(){return Object.keys(this._items.getItems())},a.prototype.forEach=function(b){if("map"!=this._property.getDefinition().getProto().type)return a.$parent.prototype.forEach.apply(this,arguments);2==arguments.length&&"function"==typeof arguments[1]&&(b=arguments[1]),"function"!=typeof b&&Subclass.Error.create("InvalidArgument").argument("the callback",!1).received(b).expected("a function").apply();var c=this._items.getItems(),d=[],e=this;for(var f in c)if(c.hasOwnProperty(f)){var g=c[f];d.push(g.getValue().priority)}d=d.sort(function(a,b){return a=parseInt(a),b=parseInt(b),a>b?-1:b>a?1:0});for(var h=0;h<d.length;h++)for(f in c)if(c.hasOwnProperty(f)){g=c[f];var i=g.getValue();if(i.priority==d[h]&&b.call(e,i,f)===!1)return!1}},a.prototype.getData=function(){var a={},b=this;return this.forEach(function(c,d){a[d]=b._items.get(d).getData()}),a},a}(),Subclass.Property.Type.Collection.ObjectCollection.ObjectCollectionProperty=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.CollectionProperty,a.getCollectionClass=function(){return Subclass.Property.Type.Collection.ObjectCollection.ObjectCollection},a}(),Subclass.Property.Type.Collection.ObjectCollection.ObjectCollectionType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.Type.Collection.CollectionType,a.getName=function(){return"objectCollection"},a.getPropertyClass=function(){return Subclass.Property.Type.Collection.ObjectCollection.ObjectCollectionProperty},a.prototype.validateValue=function(b){a.$parent.prototype.validateValue.apply(this,arguments),null!==b&&(b&&"object"==typeof b&&Subclass.Tools.isPlainObject(b)||Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a plain object").apply())},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]={},b},a.prototype.processData=function(){var b=this.getPropertyManager(),c=b.normalizeTypeDefinition(this.getProto());"map"==c.type&&(c.schema||(c.schema={}),c.schema["extends"]||(c.schema["extends"]={type:"string",nullable:!0}),c.schema.priority||(c.schema.priority={type:"number"})),a.$parent.prototype.processData.call(this)},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Array={},Subclass.Property.Type.Array.ArrayType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"array"},a.prototype.validateValue=function(b){return a.$parent.prototype.validateValue.call(this,b),b&&!Array.isArray(b)&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("an array").apply(),!0},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]=[],b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Boolean={},Subclass.Property.Type.Boolean.BooleanType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"boolean"},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.nullable=!1,b["default"]=!1,b},a.prototype.validateValue=function(b){return a.$parent.prototype.validateValue.call(this,b),b&&"boolean"!=typeof b&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a boolean").apply(),!0},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.attach=function(b){if(a.$parent.prototype.attach.apply(this,arguments),this.isAccessors()){var c=this.getName(),d=Subclass.Tools.generateGetterName(c),e=Subclass.Tools.generateCheckerName(c);b[e]=b[d]}},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Class={},Subclass.Property.Type.Class.ClassType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"class"},a.getEmptyDefinition=function(){return!1},a.parseRelatedClasses=function(a){return a.className?[a.className]:void 0},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=4){var b={};return a[0]&&(b.type=a[0]),a.length>=2&&(b.className=a[1]),a.length>=3&&(b["default"]=a[2]),4==a.length&&(b.writable=a[3]),b}return a},a.prototype.validateValue=function(b){a.$parent.prototype.validateValue.call(this,b);var c=this.getClassName();(!b&&null!==b||"object"!=typeof b||b&&"object"==typeof b&&(!b.$_className||!b.isInstanceOf(c)))&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected('an instance of class "'+c+'" or null').apply()},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.validateClassName=function(a){"string"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("className").received(a).property(this).expected("a string").apply();var b=this.getPropertyManager().getModule().getClassManager();b.isset(a)||Subclass.Error.create('Specified non existent class in "'+a+'" attribute in definition of property '+property+".")},a.prototype.setNullable=function(a){this.validateNullable(a),"boolean"!=typeof a||a||Subclass.Error.create('The "class" property '+this+" can't be not nullable.")},a.prototype.setClassName=function(a){this.validateClassName(a),this.getData().className=a},a.prototype.getClassName=function(){return this.getData().className},a.prototype.getRequiredOptions=function(){var b=a.$parent.prototype.getRequiredOptions.call(this);return b.concat(["className"])},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.className=null,b["default"]=null,b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Constructor={},Subclass.Property.Type.Constructor.ConstructorType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"constructor"},a.getEmptyDefinition=function(){return!1},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=5){var b={},c=!1;return a[0]&&(b.type=a[0]),a.length>=2&&(b.construct=a[1]),a.length>=3&&(b["default"]=a[2],null===a[2]&&(c=!0)),a.length>=4&&(b.writable=a[3]),5==a.length&&(b.nullable=a[4]),c&&(b.nullable=!0),b}return a},a.prototype={setNullable:function(a){this.validateNullable(a),"boolean"!=typeof a||a||Subclass.Error.create('The "constructor" type property '+this+" should be always nullable.")},validateValue:function(b){a.$parent.prototype.validateValue.call(this,b);var c=this.getConstruct();return null===b||"object"==typeof b&&b instanceof c||Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("an object which is instance of constructor function "+c.name).apply(),!0},validateConstruct:function(a){"function"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("construct").property(this).received(a).expected("a constructor function which prototype the object value should inherit").apply()},setConstruct:function(a){this.validateConstruct(a),this.getData().construct=a},getConstruct:function(){return this.getData().construct},getRequiredOptions:function(){var b=a.$parent.prototype.getRequiredOptions.call(this);return b.concat(["construct"])},getBaseData:function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.construct=null,b["default"]=null,b}},a.prototype.validateDefault=a.prototype.validateValue,Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Enum={},Subclass.Property.Type.Enum.EnumType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"enum"},a.getEmptyDefinition=function(){return!1},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=4){var b={};return a[0]&&(b.type=a[0]),a.length>=2&&(b.allows=a[1]),a.length>=3&&(b["default"]=a[2]),4==a.length&&(b.writable=a[3]),b}return a},a.prototype.getEmptyValue=function(){return this.getAllows()[0]},a.prototype.validateValue=function(b){if(a.$parent.prototype.validateValue.apply(this,arguments),null===b)return!0;var c=this.getAllows();return c.indexOf(b)<0&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("one of the specified values ["+c.join(", ")+"]").apply(),!0},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.validateAllows=function(a){a&&Array.isArray(a)&&a.length||Subclass.Error.create("InvalidPropertyOption").option("allows").property(this).received(a).expected('a not empty array with items of a certain types: "string", "number", "boolean" or null.').apply();for(var b=["string","number","boolean"],c=0;c<a.length;c++)b.indexOf(typeof a[c])<0&&null!==a[c]&&Subclass.Error.create('Specified not valid values in "allows" parameter in definition of property '+this+". Allowed types are: "+b.join(", ")+'" or null.')},a.prototype.setAllows=function(a){this.validateAllows(a),this.getData().allows=a},a.prototype.getAllows=function(){return this.getData().allows},a.prototype.getRequiredOptions=function(){var b=a.$parent.prototype.getRequiredOptions.call(this);return b.concat(["allows"])},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.call(this);return b.allows=null,b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Function={},Subclass.Property.Type.Function.FunctionType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"function"},a.prototype.validateValue=function(b){return a.$parent.prototype.validateValue.apply(this,arguments),b&&"function"!=typeof b&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a function").apply(),!0},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]=function(){},b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Mixed={},Subclass.Property.Type.Mixed.MixedType=function(){function a(){a.$parent.apply(this,arguments),this._allowedTypes=[]}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"mixed"},a.getEmptyDefinition=function(){return!1},a.normalizeDefinition=function(a){if(Array.isArray(a)&&a.length>=1&&a.length<=5){var b={},c=!1;return a[0]&&(b.type=a[0]),a.length>=2&&(b.allows=a[1]),a.length>=3&&(b["default"]=a[2],null===a[2]&&(c=!0)),a.length>=4&&(b.writable=a[3]),5==a.length&&(b.nullable=a[4]),c&&(b.nullable=!0),b}return a},a.prototype.getAllowedTypes=function(){return this._allowedTypes},a.prototype.addAllowedType=function(a){a.defaultless=!0,this._allowedTypes.push(this.getPropertyManager().createProperty("mixedProperty",a,this.getContextClass(),this))},a.prototype.validateValue=function(b){if(a.$parent.prototype.validateValue.call(this,b),null===b)return!0;for(var c=this.getAllowedTypes(),d=!0,e=0;e<c.length;e++){var f=c[e];try{f.validateValue(b),d=!1;break}catch(g){}}return d&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected('one of the specified types: "'+this.getAllowsNames().join('", "')+'"').apply(),!0},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.setDefault=function(b){if(!this.isNullable()&&null===b){var c=this.getAllows(),d=this.getPropertyManager().createProperty("mixedPropertyType",c[0]);b=d.getDefault()}return a.$parent.prototype.setDefault.call(this,b)},a.prototype.validateAllows=function(a){a&&Array.isArray(a)&&a.length||Subclass.Error.create("InvalidPropertyOption").option("allows").property(this).received(a).expected("a not empty array with definitions of needed property types").apply();for(var b=0;b<a.length;b++)Subclass.Tools.isPlainObject(a[b])||Subclass.Error.create('Specified not valid values in "allows" option in definition of property '+this+". It must be property definitions.")},a.prototype.normalizeAllows=function(a){var b=this.getPropertyManager();if(a&&Array.isArray(a))for(var c=0;c<a.length;c++)a[c]=b.normalizeTypeDefinition(a[c]);return a},a.prototype.setAllows=function(a){a=this.normalizeAllows(a),this.validateAllows(a),this.getData().allows=a},a.prototype.getAllows=function(){return this.getData().allows},a.prototype.getAllowsNames=function(){for(var a=this.getAllows(),b=[],c=0;c<a.length;c++)b.push(a[c].type);return b},a.prototype.getRequiredAttributes=function(){var b=a.$parent.prototype.getRequiredAttributes.call(this);return b.concat(["allows"])},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.allows=[],b["default"]=null,b},a.prototype.processData=function(){var b=this.normalizeAllows(this.getAllows());if(b&&Array.isArray(b))for(var c=0;c<b.length;c++)Subclass.Tools.isPlainObject(b[c])&&this.addAllowedType(b[c]);a.$parent.prototype.processData.call(this)},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Number={},Subclass.Property.Type.Number.NumberType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"number"},a.prototype.validateValue=function(b){if(a.$parent.prototype.validateValue.call(this,b),null!==b){var c=this.getMinValue(),d=this.getMaxValue(),e=!1;"number"!=typeof b&&(e=!0),!e&&null!==c&&c>b&&Subclass.Error.create("The value of the property "+this+" is too small and must be more or equals the number "+c+"."),!e&&null!==d&&b>d&&Subclass.Error.create("The value of the property "+this+" is too high and must be less or equals the number "+d+"."),e&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a number").apply()}},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.validateMaxValue=function(a){null!==a&&"number"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("maxValue").received(a).property(this).expected("a number or null").apply()},a.prototype.setMaxValue=function(a){this.validateMaxValue(a),this.getData().maxValue=a,this.validateMinMaxValues()},a.prototype.getMaxValue=function(){return this.getData().maxValue},a.prototype.validateMinValue=function(a){null!==a&&"number"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("minValue").received(a).property(this).expected("a number or null").apply()},a.prototype.setMinValue=function(a){this.validateMinValue(a),this.getData().minValue=a,this.validateMinMaxValues()},a.prototype.getMinValue=function(){return this.getData().minValue},a.prototype.validateMinMaxValues=function(){var a=this.getMinValue(),b=this.getMaxValue();null!==a&&null!==b&&a>b&&Subclass.Error.create('The "maxLength" attribute value must be higher than "minLength" attribute value in definition of property '+this+" must be number or null.")},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.maxValue=null,b.minValue=null,b.nullable=!1,b["default"]=0,b},a.prototype.validateData=function(){a.$parent.prototype.validateData.apply(this,arguments),this.validateMinMaxValues()},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Object={},Subclass.Property.Type.Object.ObjectType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"object"},a.prototype.validateValue=function(b){a.$parent.prototype.validateValue.call(this,b),null===b||Subclass.Tools.isPlainObject(b)||Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a plain object").apply()},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]={},b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.String={},Subclass.Property.Type.String.StringType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"string"},a.prototype.validateValue=function(b){if(a.$parent.prototype.validateValue.call(this,b),null!==b){var c=this.getPattern(),d=this.getMinLength(),e=this.getMaxLength(),f=!1;"string"!=typeof b&&(f=!0),f||!c||c.test(b)||Subclass.Error.create('The value "'+b+'" of the property '+this+' is not valid and must match the regular expression "'+c.toString()+'".'),!f&&null!==d&&b.length<d&&Subclass.Error.create('The value "'+b+'" of the property '+this+" is too short and must consist of at least "+d+" symbols."),!f&&null!==e&&b.length>e&&Subclass.Error.create('The value "'+b+'" of the property "'+this+'" is too long and must be not longer than '+e+" symbols."),f&&Subclass.Error.create("InvalidPropertyValue").property(this).received(b).expected("a string").apply()}},a.prototype.validateDefault=a.prototype.validateValue,a.prototype.validatePattern=function(a){null===a||"object"==typeof a||a instanceof RegExp||Subclass.Error.create("InvalidPropertyOption").option("pattern").received(a).property(this).expected("a RegExp instance or null").apply()},a.prototype.setPattern=function(a){this.validatePattern(a),this.getData().pattern=a},a.prototype.getPattern=function(){return this.getData().pattern},a.prototype.validateMaxLength=function(a){null!==a&&"number"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("maxLength").received(a).property(this).expected("a number or null").apply()},a.prototype.setMaxLength=function(a){this.validateMaxLength(a),this.getData().maxLength=a,this.validateMinMaxLengths()},a.prototype.getMaxLength=function(){return this.getData().maxLength},a.prototype.validateMinLength=function(a){null!==a&&"number"!=typeof a&&Subclass.Error.create("InvalidPropertyOption").option("minLength").received(a).property(this).expected("a number or null").apply()},a.prototype.setMinLength=function(a){this.validateMinLength(a),this.getData().minLength=a,this.validateMinMaxLengths()},a.prototype.getMinLength=function(){return this.getData().minLength},a.prototype.validateMinMaxLengths=function(){var a=this.getMinLength(),b=this.getMaxLength();null!==a&&null!==b&&a>b&&Subclass.Error.create('The "maxLength" attribute value must be more than "minLength" attribute value in definition of property '+this+" must be number or null.")},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b.nullable=!1,b.pattern=null,b.maxLength=null,b.minLength=null,b["default"]="",b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.Type.Untyped={},Subclass.Property.Type.Untyped.UntypedType=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.Property.PropertyType,a.getName=function(){return"untyped"},a.prototype.getBaseData=function(){var b=a.$parent.prototype.getBaseData.apply(this,arguments);return b["default"]=null,b},Subclass.Property.PropertyManager.registerPropertyType(a),a}(),Subclass.Property.ConfigContainer=function(){function a(a){a&&a instanceof Subclass.ModuleInstance||Subclass.Error.create("InvalidArgument").argument("the module instance",!1).expected('an instance of class "Subclass.ModuleInstance"').received(a).apply(),this._moduleInstance=a,this._module=a.getModule(),this._configManager=Subclass.Tools.createClassInstance(Subclass.Property.ConfigManager,this),this._configs=null,this._initialized=!1}return a.prototype={initialize:function(){this.isInitialized()&&Subclass.Error.create("The config container is already initialized!");var a=this.getModule().getModule(),b=this.getModuleInstance(),c=b.getServiceContainer();this._configs=this.getConfigManager().createConfigs(),c.setServiceInstance("configs",this._configs),c.setServiceInstance("config_container",this),c.setServiceInstance("config_manager",this.getConfigManager()),c.setServiceInstance("property_manager",this.getModule().getPropertyManager()),a.triggerOnConfig(this.getConfigs(),b)},isInitialized:function(){return this._initialized},getModule:function(){return this._module},getModuleInstance:function(){return this._moduleInstance},getConfigManager:function(){return this._configManager},getConfigs:function(){return this._configs},setConfigs:function(a){var b=this.getConfigs();b.setData(b),b.setData(this.normalizeConfigs(b.getData()))}},a}(),Subclass.Property.ConfigManager=function(){function a(a){a&&a instanceof Subclass.Property.ConfigContainer||Subclass.Error.create("InvalidArgument").argument("the instance of config container",!1).expected('an instance of class "Subclass.Property.ConfigContainer"').received(a).apply(),this._configContainer=a,this._configurators=[],this._tree=null}return a.prototype={getConfigContainer:function(){return this._configContainer},getModuleInstance:function(){return this.getConfigContainer().getModuleInstance()},getConfigsClass:function(){var a=this.getModuleInstance().getModule();if(a.issetConfigsClass())return a.getConfigsClass();var b=a.getClassManager().build("Config").setName("ModuleConfig_"+Math.round(Math.random()*((new Date).valueOf()/1e5))).setBody(this.createTree()).setFinal(!0).save();return a.setConfigsClass(b.getName()),b},createConfigs:function(){for(var a=this.getModuleInstance(),b=a.getServiceContainer(),c=b.findByTag("config"),d=0;d<c.length;d++)c[d].setConfigManager(this),this.register(c[d]);var e=this.getConfigsClass().createInstance(),f=this.normalizeConfigs(this.getDefaults());for(e.setData(f),e.setDefaults(f),d=0;d<c.length;d++){var g=c[d].getName(),h=e.issetProperty(g)?e[g]:{};c[d].processConfigs(h,e)}return e},normalizeConfigs:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)a[b]=this.normalizeConfigs(a[b]);else if(a&&"object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&(a[c]=this.normalizeConfigs(a[c]));else if(a&&"string"==typeof a){var d=this.getModuleInstance(),e=d.getParser();a=e.parse(a)}return a},getDefaults:function(){return this.getModuleInstance().getModule().getSettingsManager().getConfigs()},getConfigurators:function(){return this._configurators},register:function(a){a&&"object"==typeof a&&a.isImplements&&a.isImplements("Subclass/ConfiguratorInterface")||Subclass.Error.create("InvalidArgument").argument("the instance of configurator",!1).expected('an instance of configurator which implements interface "Subclass/ConfiguratorInterface"').received(a).apply(),this.isset(a.getName())&&Subclass.Error.create('Trying to add already registered module configurator named "'+a.getName()+'"'),this._configurators.push(a)},get:function(a){this.isset(a)||Subclass.Error.create('Trying to get not registered module configurator named "'+a+'"');var b=this.getConfigurators(),c=this.find(a);return b[c]},isset:function(a){return this.find(a)>=0},find:function(a){for(var b=this.getConfigurators(),c=0;c<b.length;c++)if(b[c].getName()==a)return c;return-1},remove:function(a){var b=this.getConfigurators(),c=this.find(a);c>=0&&b.splice(c,1)},getTree:function(){return this._tree},createTree:function(){null!==this._tree&&Subclass.Error.create("Module configuration tree is already created. So you can't do this again.");for(var a=this.getConfigurators(),b={},c=0;c<a.length;c++)if(!a[c].isPrivate())if(a[c].isExpanded()){var d=a[c].getTree();for(var e in d)d.hasOwnProperty(e)&&(b[e]=Subclass.Tools.copy(d[e]))}else b[a[c].getName()]=a[c].getTree();return this._tree=b,this.alterTree(),this._tree},alterTree:function(){for(var a=this.getConfigurators(),b=this.getTree(),c=0;c<a.length;c++){var d=a[c].getName(),e=b[d]||{};a[c].alterTree(e,b);

}}},a}(),Subclass.registerPlugin(function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=Subclass.SubclassPlugin,a.getName=function(){return"SubclassConfig"},a.getDependencies=function(){return["SubclassInstance","SubclassParser","SubclassParameter","SubclassService"]},a}()),Subclass.Property.WatcherEvent=function(){function a(a,b,c){a&&"object"==typeof a&&a instanceof Subclass.Property.Property||Subclass.Error.create("InvalidArgument").argument("property instance").expected("an instance of class Subclass.Property.Proeprty").received(a).apply(),this._property=a,this._stopped=!1,this._oldValue=c,this._newValue=b,this._diffValue=null}function b(a,c){var d;if(Array.isArray(a)&&Array.isArray(c)){d=[];for(var e=0;e<a.length;e++)Subclass.Tools.isEqual(a[e],c[e])||(d[e]=b(a[e],c[e]))}else if(Subclass.Tools.isPlainObject(a)&&Subclass.Tools.isPlainObject(c)){d={};for(var f in a)a.hasOwnProperty(f)&&(Subclass.Tools.isEqual(a[f],c[f])||(d[f]=b(a[f],c[f])))}else d=a;return Subclass.Tools.copy(d)}return a.prototype={setProperty:function(a){this._property=a},getProperty:function(){return this._property},startPropagation:function(){this._stopped=!1},stopPropagation:function(){this._stopped=!0},isPropagationStopped:function(){return this._stopped},setNewValue:function(a){this._diffValue=null,this._newValue=a},getNewValue:function(){return this._newValue},setOldValue:function(a){this._diffValue=null,this._oldValue=a},getOldValue:function(){return this._oldValue},getDiffValue:function(){return this._diffValue?this._diffValue:(this._diffValue=b(this.getNewValue(),this.getOldValue()),this._diffValue)}},a}()}();